api.valvx.se {
	encode gzip

	header Content-Security-Policy "default-src 'none';"
	header Cross-Origin-Embedder-Policy "require-corp"
	header Cross-Origin-Resource-Policy "same-origin"
	header Cross-Origin-Opener-Policy "same-origin"
	header Referrer-Policy "strict-origin-when-cross-origin"
	header Permissions-Policy ""
	header X-Content-Type-Options "nosniff"
	header X-Frame-Options "DENY"
	header X-XSS-Protection "0"
	header X-Robots-Tag "none"

	reverse_proxy {
		to 127.0.0.1:4000
	}
}

app.valvx.se {
	encode gzip

	# All security headers restored â€” IFC parsed client-side via web-ifc WASM
	# No iframes, no Speckle, no CORS relaxation needed
	header Cross-Origin-Embedder-Policy "require-corp"
	header Cross-Origin-Resource-Policy "same-origin"
	header Cross-Origin-Opener-Policy "same-origin"
	header Referrer-Policy "strict-origin-when-cross-origin"
	header Permissions-Policy ""
	header X-Content-Type-Options "nosniff"
	header X-Frame-Options "DENY"
	header X-XSS-Protection "0"
	header X-Robots-Tag "none"

	reverse_proxy {
		to 127.0.0.1:5000
	}
}

storage.valvx.se {
	encode gzip

	header Content-Security-Policy "default-src 'self'; frame-ancestors https://app.valvx.se;"
	header Cross-Origin-Embedder-Policy "require-corp"
	header Cross-Origin-Resource-Policy "cross-origin"
	header Cross-Origin-Opener-Policy "same-origin"
	header Referrer-Policy "strict-origin-when-cross-origin"
	header Permissions-Policy ""
	header X-Content-Type-Options "nosniff"
	header X-XSS-Protection "0"
	header X-Robots-Tag "none"

	reverse_proxy {
		to 127.0.0.1:9000

		header_down -X-XSS-Protection
	}
}

:80 {
	handle /healthz {
		respond "ok"
	}
}
